#include<stdlib.h>
#include<stdio.h>
#include<unistd.h>
#include<string.h>
#include<fcntl.h>
#include<sys/types.h>
#include<sys/stat.h>

typedef struct{
	int id;
	char name[30];
	char author[30];
	char publisher[30];
	float price;
}book;

int main(){
	char buffer[50] = "", id[5] = "";
	char filename[30] = "a.txt";
	int fd, k;
	char c;
	book temp;
	while(k!=5){
	printf("Enter:\n1.Insert New Book\n2.Display all books\n3.Search a book\n4.Modify a book\n5.Exit\n");
	scanf("%d",&k);
	switch(k){
	case 1:{
		fd = open(filename, O_CREAT | O_RDWR | O_APPEND, 0666);
		printf("Enter Book Name: ");
		scanf("%s",temp.name);
		printf("Enter Author Name: ");
		scanf("%s",temp.author);
		printf("Enter Publisher Name: ");
		scanf("%s",temp.publisher);
		printf("Enter Price: ");
		scanf("%f",&temp.price);
		sprintf(buffer, "%c%c%c%c%c", temp.name[0], temp.name[1], temp.author[0], temp.author[1], temp.publisher[0]);
		for(int i = 0; i<5;i++){
			temp.id += buffer[i];
		}
		sprintf(buffer, "%3d%30s%30s%30s%30.2f\n",temp.id%10000, temp.name, temp.author, temp.publisher, temp.price);
		write(fd, buffer, strlen(buffer));
		close(fd);
		break;
	}
	case 2:{
		fd = open(filename, O_RDONLY, 0666);
		printf("ID\t\t\tBook Name\t\t\tAuthor\t\t\t\tPublisher\t\t\tPrice\n");
		while(read(fd, &c, 1)==1)
			printf("%c",c);
		close(fd);
		break;
	}
	case 3:{
		fd = open(filename, O_RDONLY, 0666);
		printf("Enter Id: ");
		scanf("%s",id);
		while(read(fd, buffer, 130)){
			if(id[0]== buffer[0] && id[1]==buffer[1] && id[2]==buffer[2] && id[3]==buffer[3])
			{
				printf("%s",buffer);
				break;
			}
		}
		break;
	}
	}
	}
	
	return 0;	
}
